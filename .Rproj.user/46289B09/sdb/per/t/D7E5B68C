{
    "collab_server" : "",
    "contents" : "#' Simple simulation about potential outcomes and causal estimation\n#'\n#' Make a binary causal state, a binary valued potential outcome\n#' @param n number of individuals\n#' @param seed integer value for random seed\n#' @return data.table with potential outcomes\n#' @import data.table\n#' @export\nsimulate_potential_outcomes <- function(n,seed = sample.int(.Machine$integer.max, 1))\n{\n  set.seed(seed)\n  outcome_values <- c(1, 0)\n  prob_y1 <- .55\n  prob_y0 <- .45\n  DATA <- data.table(\n    y0 = 1 * (runif(n) < prob_y0),\n    y1 = 1 * (runif(n) < prob_y1))\n  attr(DATA, \"seed\") <- seed\n  DATA\n}\n\n#' Simulates potential outcomes and adds a treatment variable\n#' @param n number of individuals\n#' @param prob_treatment probability of treatment\n#' @param seed integer value for random seed\n#' @return data.table with potential outcomes\n#' @import data.table\n#' @export\nsimulate_simple_experiment <- function(n, prob_treatment = .5,\n                                       seed = sample.int(.Machine$integer.max, 1))\n{\n  set.seed(seed)\n  DATA <- simulate_potential_outcomes(n, seed = seed)\n  DATA[, prob := prob_treatment]\n  DATA[, d := 1 * (runif(n) < prob)]\n  DATA[, y := d * y1 + (1 - d) * y0]\n  DATA[, `:=`(y1 = NULL, y0 = NULL)]\n  attr(DATA, \"seed\") <- seed\n  DATA\n}\n\n#' Calculate naive difference in means\n#'\n#' Calculate naive difference in means\n#' @param DATA data.table generated by simulate_simple_experiment\n#' @return estimated average\n#' @import data.table\n#' @export\ncalc_naive_difference_in_means <- function(DATA)\n{\n  DATA[, mean(y[d == 1]) - mean(y[d == 0])]\n}\n\n#' Simulate an observational study\n#'\n#' This study will all individuals to select their treatment value\n#' based on their potential outcomes\n#' @param n number of individuals\n#' @param seed integer value for random seed\n#' @return data.table with potential outcomes\n#' @import data.table\n#' @export\nsimulate_observational_data <- function(n,\n                                        seed = sample.int(.Machine$integer.max, 1))\n{\n  set.seed(seed)\n  DATA <- simulate_potential_outcomes(n, seed = seed)\n  DATA[, prob := plogis(-2 + 4 * (y1 - y0))]\n  DATA[, d := 1 * (runif(n) < prob)]\n  DATA[, y := d * y1 + (1 - d) * y0]\n  DATA[, `:=`(y1 = NULL, y0 = NULL, prob = NULL)]\n  attr(DATA, \"seed\") <- seed\n  DATA\n}\n\n#' Simulate data that corresponds to Figure 4.1 from Morgan & Winship (2007)\n#'\n\n#' Data generation\n#' @param n number of observations\n#' @param seed RNG seed\n#' @return data.table with potential outcomes\n#' @import data.table\n#' @export\nmake_data_for_figure_4_1 <- function(n,\n                                     seed = sample.int(.Machine$integer.max, 1))\n{\n  set.seed(seed)\n  u <- rbinom(n, 1, prob = .5)\n  s <- rbinom(n, 1, prob = plogis(-1 + 2 * u))\n  x <- rbinom(n, 1, prob = plogis(1 - 2 * u))\n  d <- rbinom(n, 1, prob = plogis(-3  + 6 * s))\n  y1 <- rbinom(n, 1, prob = plogis(-1 + 2 * 1 - 2 * x))\n  y0 <- rbinom(n, 1, prob = plogis(-1 + 2 * 0 - 2 * x))\n  y <- d * y1 + (1 - d) * y0\n  DATA <- data.table(y1, y0, y, u, s, x, d)\n  attr(DATA, \"seed\") <- seed\n  DATA\n}\n\n\n#' Calculate average causal effect estimand\n#'\n#' DETAIL\n#' @param DATA a dataset with potential outcomes named y0 and y1\n#' @return number\n#' @import data.table\n#' @export\ncalc_average_causal_effect_estimand <- function(DATA, conditioning_variable)\n{\n  DATA[, mean(y1 - y0)]\n}\n\n\n#' Calculate the naive difference in means\n#' @param DATA a dataset, can't have a variable named \"Z\" in it\n#' @param conditioning_variable character object for variable name in DATA;\n#' assumed to be binary 0-1\n#' @return number\n#' @import data.table\n#' @export\ncalc_conditional_difference_in_means <- function(DATA, conditioning_variable)\n{\n  Z <- DATA[, conditioning_variable, with = FALSE]\n  p_Z_1 <- DATA[, mean(Z == 1)]\n  p_Z_0 <- DATA[, mean(Z == 0)]\n  mean_y_D_1_Z_1 <- DATA[, mean(y[d == 1 & Z == 1])]\n  mean_y_D_1_Z_0 <- DATA[, mean(y[d == 1 & Z == 0])]\n  mean_y_D_0_Z_1 <- DATA[, mean(y[d == 0 & Z == 1])]\n  mean_y_D_0_Z_0 <- DATA[, mean(y[d == 0 & Z == 0])]\n  (p_Z_1 * mean_y_D_1_Z_1 + p_Z_0 * mean_y_D_1_Z_0) -\n    (p_Z_1 * mean_y_D_0_Z_1 + p_Z_0 * mean_y_D_0_Z_0)\n}\n\n\n",
    "created" : 1473698744758.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1101567883",
    "id" : "D7E5B68C",
    "lastKnownWriteTime" : 1473697594,
    "last_content_update" : 1473697594,
    "path" : "~/R/workspace/causalA16/R/simulation.R",
    "project_path" : "R/simulation.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}